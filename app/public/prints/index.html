<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
    body,span,img,p,div{margin: 0;padding: 0;}
    body{width: 5.8cm;font-size: 14pt;font-weight: bold;word-break: break-all;}
    .center{text-align: center;}.right{text-align: right;}
    .f30{font-size: 30pt;}
    .f24{font-size: 24pt;}
    .border{display: block;border-bottom: 2px dashed black;margin: 10pt 0;}
    .line{line-height: 20pt;}
    .tab{
        display: flex;display: -webkit-flex;
        align-items: center;
        height: 30pt;border: 2px dashed black;
        border-right: 0;border-left: 0;
    }
    .tab>span{width: 25%;text-align: center}
    .empty{display: block;height: 20pt;}
    .img-box{display: flex;display: -webkit-flex;justify-content: center;}
    .img-box>img{width: 5.8cm;height: 5.8cm;}
    </style>
</head>
<body>
<p class="center" onclick="window.print();">(全国连锁)</p>
<p class="center f24">速洗达洗衣</p>
<p class="border"></p>
<p class="center" style="padding-bottom:5pt;">美国GEP干洗</p>
<p class="center">洗&emsp;衣&emsp;凭&emsp;据</p>
<p class="line">交易单号：<span id='ordersn'>2323323222232</span></p>
<p class="line">顾客电话：<span id='mobile'>1883434232</span></p>
<p class="line">件数：<span id='num'>5</span>件</p>
<p class="line">顾客签字：</p>
<p class="tab"><span>名称</span><span>价格</span><span>颜色</span><span>瑕疵</span></p>
<div id="items">
    <p class="line">
        <span>毛呢外套(干洗)</span>
        &emsp;
        <span>15</span>
        &emsp;
        <span>黑色，红色</span>
        &emsp;
        <span>有很多的瑕疵</span>
    </p>
    <p class="line">
        <span>毛呢外套(干洗)</span>
        &emsp;
        <span>15</span>
        &emsp;
        <span>黑色，红色</span>
        &emsp;
        <span>有很多的瑕疵wewewewwe</span>
    </p>
</div>
<p class="line">总额：<span id='amount'>154</span>(附加费：<span id='other_amount'>0.00</span>元)</p>
<p class="border"></p>
<p id="pay_state0" class="right f24" style="display:none;">未付款</p>
<div id="pay_state1" style="display:none;">
    <p class="f24" id="real_amount">实收：<span id="pay_amount">218.00</span>元</p>
    <p class="line">付款方式：<span id="pay_channel">平台会员卡</span></p>
    <p class="line">优惠：<span id="reduce_price">50</span></p>
</div>
<p class="empty"></p>
<p class="line">本店地址：<span id="address">dfdfdfdfdfdfdfdfdfdffdfdfdfddffffdfd</span></p>
<p class="line">服务热线：<span id="phone">18734343434</span></p>
<p class="line">店&emsp;&emsp;员：<span id="clerk">哈哈哈</span></p>
<p class="line">店&emsp;&emsp;号：<span id="id">dfdfd</span></p>
<p class="line">打印日期：<span id="date">2017-11-07 18:24</span></p>
<p class="img-box"><img src="qrcode.jpg" id="qrcode"/></p>
<p class="line center">（订单二维码）</p>
<p class="border"></p>
<p class="line center">欢迎下次再来</p>
<p class="line center">请仔细阅读本单</p>
<p class="border"></p>
<p class="line center">门店联</p>
<script>
    const {ipcRenderer} = require('electron'),
          axios = require('axios');
    window.onload = function() {
        //const params = ipcRenderer.sendSync('get-params');
        const params = {token:'9f04XUc2V8VLs1PU12esgTsnamiP0lFyk9MWUgdmi3yEoTdcAiQh0P4',order_id:'1967',uid:'84'}
        const fd = new FormData();
        const date = new Date(),
              datetime = date.getFullYear()+'-'+(date.getMonth()*1+1)+'-'+date.getDate()+' '+date.getHours()+':'+date.getMinutes();
        fd.append('token', params.token);
        fd.append('order_id', params.order_id);
        fd.append('clerk_id', params.uid);
        axios.post('http://xiyi.wzj.dev.shuxier.com/app.php/Offline/PrintInfo/o_p', fd)
        .then(response => {
            let result = response.data.data,
                order = result.orderInfo,
                items = result.items;
            console.log(result);
            document.getElementById('qrcode').src = order.qrcode;
            insert('ordersn', order.ordersn);
            insert('mobile', order.mobile);
            insert('num', order.piece_num);
            insert('amount', order.amount);
            insert('other_amount', order.slave_amount);
            insert('pay_amount', order.pay_amount);
            insert('reduce_price', order.reduce_price);
            insert('address', order.address);
            insert('phone', order.phone);
            insert('clerk', order.clerkname);
            insert('id',order.mid);
            insert('date',datetime);
            if (1 == order.pay_state) {
                document.getElementById('pay_state1').style.display = 'block';
                switch(order.pay_channel){
                    case '1':
                    insert('pay_channel','现金支付');
                    break;
                    case '2':
                    insert('pay_channel','平台会员卡');
                    break;
                    case '3':
                    insert('pay_channel','专店会员卡');
                    break;
                    case '4':
                    insert('pay_channel','微信支付');
                    break;
                    case '5':
                    insert('pay_channel','支付宝支付');
                    break;
                }
            } else {
                document.getElementById('pay_state0').style.display = 'block';
            }
            let len = items.length,
                content = '';
            for (let i = 0;i < len;++i) {
                content += '<p class="line"><span>'+items[i].name+'</span>&emsp;<span>' + items[i].price +
                    '</span>&emsp;<span>'+items[i].color+items[i].color_text+'</span>&emsp;<span>'+items[i].item_note+items[i].note_text+'</span></p>';
            }
            insert('items',content);
            //ipcRenderer.send('print');
        });

        function insert(id, value) {
            if ('undefined' === typeof value || null == value) value = '';
            document.getElementById(id).innerHTML = value;
        }
    }
</script>
</body>
</html>